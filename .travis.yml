sudo: required

services:
  - docker

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -qq libxml2-utils

# We test against all influxdb versions with the most actual JDK.
# Test only the most recent influxdb version with JDK8 which will be legacy soon.
env:
  - MAVEN_JAVA_VERSION=3-jdk-10-slim INFLUXDB_VERSION=1.6
  - MAVEN_JAVA_VERSION=3-jdk-10-slim INFLUXDB_VERSION=1.5
  - MAVEN_JAVA_VERSION=3-jdk-10-slim INFLUXDB_VERSION=1.4
  - MAVEN_JAVA_VERSION=3-jdk-10-slim INFLUXDB_VERSION=1.3
  - MAVEN_JAVA_VERSION=3-jdk-10-slim INFLUXDB_VERSION=1.2
  - MAVEN_JAVA_VERSION=3-jdk-10-slim INFLUXDB_VERSION=1.1
  - MAVEN_JAVA_VERSION=3-jdk-8-slim INFLUXDB_VERSION=1.6 SNAPSHOT=Y
  global:
  - secure: hozwh5A7T26B61bz+keQ025LqfMo811lZJTQQ561rHIKTUIbLpTOxnlFgnorpJe9bIRBZPG1D+xJvjsJXOQUoEFPTRTv1RLsxrFptqNpz5yzAOvI1/aDC+/dr/oftI3ELfiC94uqqAWmOusq8aSdgYB9et7XAPyUDkcjhUejkfN/RaX6KRevYI9ZP3UqdLT2qDX7rhlbDZ1BXOqn0DI/uZn0PMGcpPciBzgl1lrAibiIisjblT2ivrlDs5KR7+q/sw06bYaYJk2s1U4oXcTWZzanL66ek7V4Ra6GqozyffhrSFddqr0vjW8HiabRpNZirkTtxXKN6B9E5jsgIB8Un3rbqXsmaiZUoVvyoSlNykawml0YwUSv1a/Jl59YtR/kxZbgM1TIsvGrdLznpPXVqpH411HPjytJmQxqG30pDhqMU88IZDo8XycilGked9ffNHK+IVdPgzJpiYhhWMKm89Mze/gNgkKKmXt33pNRSdJIKEYfkAwUKx8snXIL/cZHc3y8NL854+mGujIBza/7/wVhTzvyVteUi033TPsqPgXNA8g3RcSzv855lmbuerlfdxez3Eh2rxkh+/Ih4QqkZzAULjGPMZ611mk4XRIGuoBGYBSqaJUDLauKhpAh7HOzopo9xwHPCUlnzIho27ww7cuVWvcOpLBwTebvJ7Lzj24=
  - secure: UpZfADK7v6TvuAIlX9uEmP+P/czB5/VJLIZ4S8BSPvQHQP1EvITw9CzQ8vtRNayja/bFTkYLXOqqEiDh6z2/urT29I9OCpKjyefJGaH4gYdVw7wn72xl42/7RhgNFUMXzzzyS50PimhMSrbTifdGiytr7z7kNVUPFfg8ZghgGk8PBii5pY+UfNk90h6Mk4sK8nzJ1pAqiYn3GiVgL+CTL2cMHPffSc1sfjD2w9wdeM+VVaoPod7H+n4pduIDOniUPXREm9XrylzG0afVrnctAXZZw68JnCHwMCoFk9ieD2my9ZqRiG2hIamxVmNkEE6QnZEzrhDHBoQKntTgOaFqrm/f9lbz2h9k5wO6U28tEoLngp3UY6skrGoa1cq7XNs3SKsKetYjsXzyFof+pHJBvbggfN2bulj3Hp3arVVMRoUb/oBPR0FCQquE0XhxC9zm2y7PImicNu+Hn/fTjoYDlObs3Q8bhhx32aNpjz81t+3ojxYjJfvJ31g08XLyjJYmP3TgJGZNARK49KdWVaIhPFB2IUtM9aCKzZWGOLGh9DWNkAPnJvdDil6/pqANWQEX32asUwtR2AitW2n8fet5KxljS9D59aRwipHODxcQCo8YjLQc+xOFh4Yfid0KXg9YVxzdzX3UgJoIXHnquIf2u0MLP0bYMCVmSXBCbRjLjVg=

script: ./compile-and-test.sh

deploy:
  provider: script
  script: "./deploy-snapshot.sh"
  on:
    repo: bonitoo-io/influxdb-java
    condition: $SNAPSHOT == "Y" && $DEPLOY_SNAPSHOT == "Y"
    branch: snapshot-tests

after_success:
  - bash <(curl -s https://codecov.io/bash)

after_failure:
  - cat target/surefire-reports/*.txt
